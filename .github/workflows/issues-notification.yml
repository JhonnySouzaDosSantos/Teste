name: Notificar Issues no Discord

on:
  issues:
    types: [opened, closed, reopened]
  issue_comment:
    types: [created]

jobs:
  notificar:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar para Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_ISSUES_WEBHOOK }}
        run: |
          # Dados da Issue
          EVENT_TYPE=${{ github.event.action }}
          ISSUE_URL=${{ github.event.issue.html_url }}
          ISSUE_TITLE=${{ github.event.issue.title }}
          USER=${{ github.event.issue.user.login }}
          EVENT_DESC=${{ github.event.issue.body }}

          # Mensagem base
          MESSAGE="ðŸ“¢ **Nova Atividade em Issues**\n"
          MESSAGE+="ðŸ”¹ **Autor:** $USER\n"
          MESSAGE+="ðŸ”¹ **Tipo:** \`$EVENT_TYPE\`\n"
          MESSAGE+="ðŸ”¹ **TÃ­tulo:** [$ISSUE_TITLE]($ISSUE_URL)\n"
          MESSAGE+="ðŸ”¹ **TÃ­tulo:** \`$EVENT_DESC\`\n"
          

          # Se for um comentÃ¡rio
          if [ "$EVENT_TYPE" = "created" ]; then
            COMMENT=${{ github.event.comment.body }}
            MESSAGE+="ðŸ’¬ **ComentÃ¡rio:** ${COMMENT:0:100}...\n"  # Limita a 100 chars
          fi

          # Envia
          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\":\"$MESSAGE\"}" \
               "$WEBHOOK_URL"