name: Notificar Issues no Discord

on:
  issues:
    types: [opened, closed, reopened]
  issue_comment:
    types: [created]

jobs:
  notificar:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar para Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_ISSUES_WEBHOOK }}
        run: |
          # Dados da Issue
          EVENT_TYPE=${{ github.event.action }}
          ISSUE_URL=${{ github.event.issue.html_url }}
          ISSUE_TITLE=${{ github.event.issue.title }}
          ISSUE_BODY=${{ github.event.issue.body }}
          USER=${{ github.event.issue.user.login }}

          # Formata a mensagem
          MESSAGE="ðŸ“¢ **Nova Issue**\n"
          MESSAGE+="ðŸ”¹ **Tipo:** \`$EVENT_TYPE\`\n"
          MESSAGE+="ðŸ”¹ **TÃ­tulo:** [$ISSUE_TITLE]($ISSUE_URL)\n"
          MESSAGE+="ðŸ”¹ **Autor:** $USER\n\n"
          MESSAGE+="**DescriÃ§Ã£o:**\n"
          MESSAGE+="\`\`\`\n${ISSUE_BODY}\n\`\`\`\n"

          # Se for um comentÃ¡rio
          if [ "$EVENT_TYPE" = "created" ]; then
            COMMENT=${{ github.event.comment.body }}
            MESSAGE+="ðŸ’¬ **ComentÃ¡rio:** \n\`\`\`\n${COMMENT}\n\`\`\`"
          fi

          # Envia para o Discord (usando Python para evitar problemas de formataÃ§Ã£o)
          python3 -c "
          import os, json, requests
          webhook_url = os.environ['WEBHOOK_URL']
          payload = {'content': os.environ.get('MESSAGE')}
          requests.post(webhook_url, json=payload)
          "