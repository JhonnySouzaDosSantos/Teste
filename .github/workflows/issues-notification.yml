name: Notificar Issues no Discord

on:
  issues:
    types: [opened, closed, reopened]
  issue_comment:
    types: [created]

jobs:
  notificar:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar para Discord
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_ISSUES_WEBHOOK }}
        run: |
          # Dados b치sicos da issue (compat칤vel com ambos os eventos)
          ISSUE_URL=${{ github.event.issue.html_url }}
          ISSUE_TITLE=${{ github.event.issue.title }}
          USER=${{ github.event.issue.user.login }}

          # Mensagem base
          MESSAGE="游닉 **Nova Atividade em Issues**\n"
          MESSAGE+="游댳 **T칤tulo:** [$ISSUE_TITLE]($ISSUE_URL)\n"
          MESSAGE+="游댳 **Autor:** $USER\n"

          # Verifica o tipo de evento
          if [ "${{ github.event_name }}" = "issues" ]; then
            # Evento de abertura/fechamento/reabertura
            MESSAGE+="游댳 **Tipo:** \`${{ github.event.action }}\`\n"
          elif [ "${{ github.event_name }}" = "issue_comment" ]; then
            # Evento de coment치rio
            MESSAGE+="游댳 **Tipo:** \`comment\`\n"
            COMMENT=${{ github.event.comment.body }}
            MESSAGE+="游눫 **Coment치rio:** ${COMMENT:0:100}...\n"  # Limita a 100 chars
          fi

          # Envia para o Discord
          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\":\"$(echo "$MESSAGE" | sed 's/"/\\"/g')\"}" \
               "$WEBHOOK_URL"