name: Notificar no Discord

on:
  push:
    branches:
      - '**'

jobs:
  enviar-mensagem:
    runs-on: ubuntu-latest

    steps:
      - name: Checar o cÃ³digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Enviar notificaÃ§Ã£o para o Discord
        env:
          DISCORD_WEBHOOK_URL: "https://discord.com/api/webhooks/1394547222389194762/Q7b3I0tLxsbxQNiP9jRZQQx7uGx-9sVMcIrcItoIurbnidX9RlUG3I1a25eOyZZasFAl?thread_id=1394542894626377790"  # Substitua pelo seu URL real
        run: |
          # ObtÃ©m os dados do Ãºltimo commit
          HASH=$(git log -1 --pretty=format:"%h")
          USER=$(git log -1 --pretty=format:"%an")
          MSG=$(git log -1 --pretty=format:"%s")
          BRANCH="${{ github.ref_name }}"

          # Formata a mensagem COM EMOJIS (sem horÃ¡rio)
          MESSAGE="ðŸ“Œ **Novo Commit!**
          ðŸ‘¤ **Usuario:** $USER
          ðŸ†” **ID Hash do Commit:** \`$HASH\`
          ðŸ”¢ **Quantidade de Commits:** 1
          ðŸ’¬ **Mensagem:** $MSG
          ðŸŒ¿ **Branch:** $BRANCH"

          # Envia para o Discord (usando jq para formatar o JSON)
          JSON_PAYLOAD=$(jq -n --arg content "$MESSAGE" '{content: $content}')
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$JSON_PAYLOAD" \
               "$DISCORD_WEBHOOK_URL"